# multiCAFE
Icy plugin to analyze multiCAFE observations (multiple CApillary FEeding)

This plugin is meant to allow users to analyze stack of frames collected during multiCAFE experiments. multiCAFE is an acronym for (multiple) CApillary Feeding Experiments where we measure how much flies (drosophila for example) feed from capillary tubes containing a liquid (generally sweet water added with a blue dye and another substance to test). 

In our current design, one webcam is monitoring 10 "cages", each containing 1 fly. Each cage can be equipped with 2 capillaries. We want to follow how flies are feeding. To do so, we usually do time-lapse observations, with one 1980x1080 jpg image every minute over 1 h to several days, eventually renewing the capillaries when they are empty.

At the basic level, multiCAFE is meant to read and analyze 1 pile of images (= 1 experiment). The user defines the position of capillaries using linear ROIs (typically 20 capillaries for 10 cages). The program then create an array of kymographs to follow the evolution of the pixels described by the ROIs, ie to follow the consumption in each capillary. The top and bottom level of each capillary can be detected and the measures saved and exported to Excel.

We can follow the position of each fly in their cages across time with another set of routines. This is done either by using a simple thresholding approach or by detecting flies from images to which a reference image is subtracted. This reference image is computed by using the first frame of the stack to which flies detected are removed after they have moved from their initial position. Then this reference image is subtracted to each image of the stack so that flies appear as white objects on a black background. The xyt position of each fly is then stored and exported to Excel. These data are used mainly to monitor if flies are alive and when they stop being active.

Data collected over several experiments can be collected and the whole series of observations can be exported to an Excel file storing the raw data of different parameters measured from the capillaries or from the flies, in order to be used within pivot tables that allow users to analyze and visualize their data interactively according to several descriptors associated to the data during the analysis.

The measure unit is a "box", for example 10 individual cages with their capillaries (2) and 8 cages with flies and 2 cages empty. These empty cages are used to estimate the evaporation rate of capillaries in the absence of flies. multiCAFE can deal with several boxes per images which are analyzed independently. 

MultiCAFE is written in Java and runs under Icy. It uses extensively the wonderful library designed by Stephane Dallongevile and Fabrice de Chaumont (Institut Pasteur). The code is architectured so that most of the user interface is contained in plugin.fmp.multicafe. Routines dealing with files (reading & writing images, measures, and corresponding classes) are stored within plugins.fmp.multicafeSequence. All other routines meant to analyze data, support specific user interfaces elements, and to export them to excel are store in plugins.fmp.multicafeTools. Lastly, as the creation of kymographs is quite lenghty, this package also include a plugin BuildKymographs in plugins.fmp.multicafeBuildKymos which let the user define a list of experiments (for which the user has already defined capillaries) and create kymographs without supervision (during your coffee / tea break or overnight). 
